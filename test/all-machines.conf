!act> -- prefered order
[ host-list, key-check, web, of-this-world, endpoints, transitions, mini-link-servers, streamers, key-install ]
!
!def> -- global vars and commands
!!ship>      =sshpass -p "{${ssh}.pass}"
!!secret>    =9wriw08wrw40su
!!my-mount-otw>  =BACKUP-MEDIA
!

!> All Hosts :def =host
=addr              =abbr              =host
45.32.219.78     :  :otw            : of-this.world
155.138.235.197  :  :copious        : copious.world
155.138.235.197  :  :popsong        : popsongnow.com
76.229.181.242   :  :home           : @home -- Mint Linux 
192.168.1.81     :  :h1             : @home:LAN -- DietPi 
192.168.1.75     :  :h2             : @home:LAN -- DietPi 
192.168.1.77     :  :otw-create     : @home:LAN -- DietPi 
<!

!> ssh :def

45.32.219.78 : {
    "dns" : "of-this.world",
    "user" : "root",
    "pass" : "hH8?ocrM%gebn8MN"
}
--
155.138.235.197 : {
    "dns" : "copious.world",
    "user" : "root",
    "pass" : "L2v=95$J,q[)4wF-"
}
--
76.229.181.242 : {
    "dns" : "@home",
    "user" : "richard",
    "pass" : "L2v=95$J,q[)4wF-"
}
--
192.168.1.81 : {
    "dns" : "@home:LAN",
    "user" : "root",
    "pass" : "dietpi"
}
--
192.168.1.75 : {
    "dns" : "@home:LAN",
    "user" : "root",
    "pass" : "dietpi"
}
<!

!> path_abbreviations :def

!-> Local: =local
[github]    : ~/Documents/GitHub
[configs]   : [github]/configs
[sites]     : [alphas]/websites
[alphas]    : [github]/alphas
<-!

!-> Remotes: =remotes
[nginx-e]   : /etc/nginx/sites-enabled
[web]       : /var/www/html
[home]      : /home
<-!
<!

!> web: act

|-
top_dir_location : {
    "nginx" : "$[configs]/nginx"
    "www"   : "$[sites]",
    "configs" : "configs"
}
-|

!-> copy :
!--conf>            =$ship scp ${nginx}/${host.addr} ${ssh.user}@${host.addr}:/$[nginx-e]
!--assets>          =$ship scp ${www}/${host.abbr}/staging/* ${ssh.user}@${host.addr}:/$[web]/${host.abbr}/

!-> startup :
!--nginx>           =$ship ssh ${ssh.user}@${host.addr} "nginx -s reload"

!-> order : [ copy.conf, copy.assets, startup.nginx ]
<!


!> host-list: act

!--names>            =$ship scp ${ssh.user}@${host.addr}:/$[home]/given-name ./${host.abbr}; cat ./${host.abbr} >> host-list
!--get>
!---git>                =$ship ssh ${ssh.user}@${host.addr} "apt-get install git"
!---node>               =$ship ssh ${ssh.user}@${host.addr} "apt-get install nodejs"
!---n>                  =$ship ssh ${ssh.user}@${host.addr} "npm install -g n@latest"
!--npm>                 =$ship ssh ${ssh.user}@${host.addr} "npm install -g npm@latest"
!--nodeup>              =$ship ssh ${ssh.user}@${host.addr} "n latest"
!--gna>                 =$ship ssh ${ssh.user}@${host.addr} "npm install -g get-npm-assets"
!--csubst>              =$ship ssh ${ssh.user}@${host.addr} "npm install -g copious-subst"

!--> order : [git, node, n, npm, nodeup, gna, csubst ]

!-> order : [ host-list.names,  host-list.names.get ]
<!


!> of-this-world : act

|~host.otw :
!-prep>
!--dirs>       
!---deposit>    =$ship ssh ${ssh.user}@${host.addr} "mkdir /home/deposit"
!---uploaded>   =$ship ssh ${ssh.user}@${host.addr} "mkdir /home/deposit/uploaded"
!---people>     =$ship ssh ${ssh.user}@${host.addr} "mkdir /var/www/html/people"
!--> order(dirs) : [deposit, uploaded, people]

!--utility>
!---file-mover> 
!----npm>       =$ship ssh ${ssh.user}@${host.addr} "pushd /home/deposit;npm install -g of-this-world; get-npm-assets human-page-queue;popd"
!----starter>   =$ship scp ${configs}/server-scripts/runner.sh ${ssh.user}@${host.addr}:/home/deposit/
!---> order: [ npm, starter]
!---store-key>
!----cmd-key>   =$ship ssh ${ssh.user}@${host.addr} "pushd /home/deposit;cops-subst ./page-queue.conf secret='$secret';popd"
!----> order(cmd-key): [ cmd-key ]
!--> order(utility) : [ file-mover,store-key ]
!-> order(prep) : [dirs, utility]

!-startup>   =$ship ssh ${ssh.user}@${host.addr} "pushd /home/deposit;bash runner.sh &;disown;popd"
!-> order(host.otw) : [prep, startup]



|~host.home -> otw-create
!-prep>
!--dirs>
!---human-project>  =$ship ssh ${ssh.user}@${host.addr} "mkdir /media/$my-mount-otw/human-project"
!---humans>         =$ship ssh ${ssh.user}@${host.addr} "mkdir /media/$my-mount-otw/human-project/humans"
!--> order(dirs) : [human-project, humans]

!--utility>
!---npm>       =$ship ssh ${ssh.user}@${host.addr} "pushd /home/deposit;npm install -g of-this-world; get-npm-assets of-this-world;popd"
!---starter>   =$ship scp ${configs}/server-scripts/runner.sh ${ssh.user}@${host.addr}:/media/$my-mount-otw/human-project/
!-->order(utility) : [npm, starter]
!-> order(prep) : [dirs, utility]
!-startup>   =$ship ssh ${ssh.user}@${host.addr} "pushd /home/deposit;bash runner.sh &;disown;popd"
!-> order(otw-create) : [prep, startup]

<!


-- endpoints, transitions, mini-link-servers, streamers, key-install

!> endpoints : act
    import endpoints-all.conf
<!
!> transitions : act
    import transitions-all.conf
<!
!> mini-link-servers : act
    import mini-link-servers.conf
<!
!> streamers : act
    import  streamers-all.conf
<!
!> key-install : act
    import  all-keys.conf
<!

!> key-check : act
    import  key-checking.conf
<!